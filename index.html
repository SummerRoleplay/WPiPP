<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KWP Gda≈Ñsk ‚Äî wykroczenia, przestƒôpstwa i podstawy prawne</title>
  <link rel="icon" href="./KWP.png">
  <link rel="stylesheet" href="./style.css">
  <meta name="description" content="Summer RP| ≈öciƒÖga: wykroczenia i przestƒôpstwa wraz z podstawƒÖ prawnƒÖ i sankcjami + opis wybranych przepis√≥w (KPK i ustawa o Policji)." />
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1a2e;
      --muted:#9fb0d0;
      --text:#e9f0ff;
      --accent:#4da3ff;
      --accent2:#7cdbb6;
      --border:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --chip: rgba(77,163,255,.14);
      --danger:#ff6b6b;
      --ok:#7cdbb6;
    }
    [data-theme="light"]{
      --bg:#f6f8ff;
      --card:#ffffff;
      --muted:#51627e;
      --text:#0b1220;
      --accent:#1d6cff;
      --accent2:#0da37f;
      --border:rgba(11,18,32,.12);
      --shadow: 0 10px 30px rgba(11,18,32,.10);
      --chip: rgba(29,108,255,.10);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background: radial-gradient(1200px 600px at 10% 0%, rgba(77,163,255,.20), transparent 60%),
                  radial-gradient(900px 500px at 90% 10%, rgba(124,219,182,.16), transparent 60%),
                  var(--bg);
      color:var(--text);
      line-height:1.45;
    }

    .wrap{max-width:1100px;margin:0 auto;padding:28px 16px 40px}
    header{
      display:flex;gap:14px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;
      margin-bottom:16px;
    }
    .title{display:flex;flex-direction:column;gap:6px;min-width:min(720px,100%)}
    h1{margin:0;font-size: clamp(22px, 2.3vw, 30px);letter-spacing:.2px;}
    .sub{color:var(--muted);font-size:14px;max-width: 72ch;}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end;}
    .btn{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      color:var(--text);
      padding:10px 12px;border-radius:12px;cursor:pointer;
      box-shadow: var(--shadow);
      transition: transform .05s ease, border-color .2s ease, background .2s ease;
      font-weight:600;font-size:13px;display:inline-flex;gap:8px;align-items:center;user-select:none;
    }
    .btn:active{transform: translateY(1px)}
    .btn.secondary{box-shadow:none;background:transparent}
    .btn:hover{border-color: rgba(255,255,255,.22)}
    [data-theme="light"] .btn:hover{border-color: rgba(11,18,32,.22)}
    .btn .dot{width:9px;height:9px;border-radius:99px;background:var(--accent);box-shadow:0 0 0 4px rgba(77,163,255,.18);}

    .panel{
      background: rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius:18px;
      padding:14px;
      box-shadow: var(--shadow);
      margin-bottom:14px;
    }
    [data-theme="light"] .panel{background: rgba(11,18,32,.02)}

    .filters{display:grid;grid-template-columns: 1.5fr 1fr 1fr;gap:10px;}
    @media (max-width:900px){
      .filters{grid-template-columns:1fr}
      .toolbar{justify-content:flex-start}
      .title{min-width:100%}
    }

    .input, select{
      width:100%;
      padding:12px 12px;border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.12);
      color:var(--text);
      outline:none;
      transition:border-color .2s ease, background .2s ease;
      font-size:14px;
    }
    [data-theme="light"] .input, [data-theme="light"] select{background: rgba(11,18,32,.04)}
    .input:focus, select:focus{border-color: rgba(77,163,255,.55)}
    .hint{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;color:var(--muted);font-size:12px;}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;
      border:1px solid var(--border);
      background: var(--chip);
      color:var(--text);
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .chip strong{font-weight:800}
    .chip .mini{color:var(--muted);font-weight:600}
    .chip.active{outline:2px solid rgba(77,163,255,.35)}
    .chip:hover{border-color: rgba(255,255,255,.22)}
    [data-theme="light"] .chip:hover{border-color: rgba(11,18,32,.22)}

    .stats{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      padding:12px 14px;margin:0 0 14px;
      border-radius:18px;border:1px solid var(--border);
      background: rgba(255,255,255,.03);
    }
    [data-theme="light"] .stats{background: rgba(11,18,32,.02)}
    .stats .left{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .badge{border:1px solid var(--border);padding:7px 10px;border-radius:999px;background: rgba(255,255,255,.03);font-size:12px;color:var(--muted);}
    .badge b{color:var(--text)}
    .legend{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .legend span{font-size:12px;color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);font-size:12px;background: rgba(255,255,255,.03);}
    .pill .k{width:8px;height:8px;border-radius:99px;background:var(--accent)}
    .pill .k2{background:var(--accent2)}

    .grid{display:grid;grid-template-columns: 1fr;gap:12px;}

    details{
      border:1px solid var(--border);
      border-radius:18px;
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    [data-theme="light"] details{background: rgba(11,18,32,.02)}
    summary{
      list-style:none;
      cursor:pointer;
      padding:14px 14px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    summary::-webkit-details-marker{display:none}
    .catTitle{display:flex;flex-direction:column;gap:4px;}
    .catTitle .name{font-weight:900;letter-spacing:.2px;}
    .catTitle .desc{color:var(--muted);font-size:12px;max-width: 90ch;}
    .count{font-size:12px;color:var(--muted);border:1px solid var(--border);padding:6px 10px;border-radius:999px;background: rgba(255,255,255,.03);white-space:nowrap;}

    .items{
      border-top:1px solid var(--border);
      padding:10px 12px 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width:900px){ .items{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px 12px;
      background: rgba(0,0,0,.10);
      display:flex;flex-direction:column;gap:10px;
    }
    [data-theme="light"] .card{background: rgba(11,18,32,.03)}

    .row1{display:flex;gap:10px;align-items:flex-start;justify-content:space-between;}
    .offense{font-weight:900;margin:0;font-size:14px;}
    .meta{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
    code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px;
      background: rgba(77,163,255,.12);
      border:1px solid rgba(77,163,255,.22);
      padding:3px 7px;
      border-radius:999px;
      color: var(--text);
      white-space:nowrap;
    }
    .lawTag{background: rgba(124,219,182,.10);border:1px solid rgba(124,219,182,.22);}
    .penalty{margin:0;color:var(--muted);font-size:13px;}
    .actions{display:flex;gap:8px;flex-wrap:wrap;}
    .miniBtn{
      border:1px solid var(--border);
      background: transparent;
      color:var(--text);
      padding:8px 10px;border-radius:12px;
      cursor:pointer;
      font-weight:800;font-size:12px;
    }
    .miniBtn:hover{border-color: rgba(255,255,255,.22)}
    [data-theme="light"] .miniBtn:hover{border-color: rgba(11,18,32,.22)}

    /* ‚≠ê Ulubione */
    .starBtn{
      border:1px solid var(--border);
      background: transparent;
      color:var(--text);
      padding:8px 10px;border-radius:12px;
      cursor:pointer;
      font-weight:900;font-size:12px;
    }
    .starBtn:hover{border-color: rgba(255,255,255,.22)}
    [data-theme="light"] .starBtn:hover{border-color: rgba(11,18,32,.22)}
    .starBtn.active{
      background: rgba(255, 215, 0, .12);
      border-color: rgba(255, 215, 0, .35);
    }

    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background: rgba(0,0,0,.70);color:#fff;
      padding:10px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      box-shadow: var(--shadow);
      font-size:13px;
      opacity:0;pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-2px)}
    [data-theme="light"] .toast{background: rgba(11,18,32,.85)}

    footer{margin-top:18px;color:var(--muted);font-size:12px;}
    footer .note{
      border:1px dashed var(--border);
      border-radius:18px;
      padding:12px 14px;
      background: rgba(255,255,255,.02);
    }

    .lawSection{
      margin-top:14px;
      border:1px solid var(--border);
      border-radius:18px;
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    [data-theme="light"] .lawSection{background: rgba(11,18,32,.02)}
    .lawHeader{padding:14px 14px;border-bottom:1px solid var(--border);display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;}
    .lawHeader h2{margin:0;font-size:16px}
    .lawHeader .small{color:var(--muted);font-size:12px;max-width:90ch}
    .lawGrid{padding:12px 12px 14px;display:grid;grid-template-columns: 1fr 1fr;gap:10px;}
    @media (max-width:900px){ .lawGrid{grid-template-columns:1fr} }
    .lawCard{border:1px solid var(--border);border-radius:16px;padding:12px;background: rgba(0,0,0,.10);display:flex;flex-direction:column;gap:10px;}
    [data-theme="light"] .lawCard{background: rgba(11,18,32,.03)}
    .lawCard h3{margin:0;font-size:14px}
    .lawCard ul{margin:0;padding-left:18px;color:var(--muted);font-size:13px}
    .lawCard li{margin:6px 0}
    .lawCard .top{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .lawCard .top .meta{margin-top:2px}

    @media print{
      .toolbar, .panel, .toast{display:none !important}
      body{background:#fff;color:#000}
      details, .lawSection{box-shadow:none}
      .card, .lawCard{break-inside:avoid}
      code{border:1px solid #bbb}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>KWP Gda≈Ñsk ‚Äî wykroczenia, przestƒôpstwa i podstawy prawne</h1>
        <div class="sub"> Summer RP |
          Wyszukiwalna lista: wykroczenia + przestƒôpstwa + sankcje. Dodatkowo: kr√≥tki opis wybranych przepis√≥w (KPK i ustawa o Policji) + ≈öPB.
        </div>
      </div>

      <div class="toolbar">
        <button class="btn secondary" id="btnPrint" title="Drukuj / PDF">üñ®Ô∏è Drukuj</button>
        <button class="btn secondary" id="btnFavs" title="Poka≈º tylko ulubione">‚≠ê Ulubione</button>
        <button class="btn" id="btnTheme" title="Prze≈ÇƒÖcz motyw"><span class="dot" aria-hidden="true"></span> Motyw</button>
      </div>
    </header>

    <div class="panel">
      <div class="filters">
        <input class="input" id="q" placeholder="Szukaj: np. 92a, 178a, kradzie≈º, 244 kpk, 1500, narkotyk√≥w, art. 15‚Ä¶" />
        <select id="category">
          <option value="all">Wszystkie kategorie</option>
        </select>
        <select id="sort">
          <option value="default">Sortowanie: domy≈õlne</option>
          <option value="name_asc">Nazwa A‚ÜíZ</option>
          <option value="name_desc">Nazwa Z‚ÜíA</option>
          <option value="article_asc">Artyku≈Ç A‚ÜíZ</option>
          <option value="article_desc">Artyku≈Ç Z‚ÜíA</option>
        </select>
      </div>

      <div class="hint" id="chips"></div>
    </div>

    <div class="stats" aria-live="polite">
      <div class="left">
        <span class="badge">Wyniki: <b id="count">0</b></span>
        <span class="badge">Kategorie: <b id="catCount">0</b></span>
        <span class="badge">Ulubione: <b id="favCount">0</b></span>
      </div>
      <div class="legend">
        <span class="pill"><span class="k" aria-hidden="true"></span> KW / k.w.</span>
        <span class="pill"><span class="k2" aria-hidden="true"></span> KK / ustawy / KPK</span>
      </div>
    </div>

    <main class="grid" id="out"></main>

    <!-- Sekcja opis√≥w przepis√≥w -->
    <section class="lawSection" id="lawSection">
      <div class="lawHeader">
        <div>
          <h2>üìå Przepisy ‚Äî opis (≈õciƒÖga praktyczna)</h2>
          <div class="small">
            Kr√≥tko i operacyjnie: co daje przepis, kiedy stosowaƒá i co udokumentowaƒá. (Nie jest to porada prawna ‚Äî do czynno≈õci zawsze stosuj aktualne brzmienie przepis√≥w i procedury jednostki).
          </div>
        </div>
        <span class="count" id="lawCount">3 przepisy</span>
      </div>

      <div class="lawGrid">
        <div class="lawCard">
          <div class="top">
            <div>
              <h3>art. 244 KPK ‚Äî zatrzymanie osoby (przez Policjƒô)</h3>
              <div class="meta"><code class="lawTag">art. 244 KPK</code></div>
            </div>
            <div class="actions">
              <button class="miniBtn" data-copy="full" data-text="art. 244 KPK ‚Äî zatrzymanie osoby (przez Policjƒô)">Kopiuj</button>
            </div>
          </div>
          <ul>
            <li><b>O co chodzi:</b> przepis reguluje podstawy i tryb <b>zatrzymania osoby</b> przez Policjƒô w postƒôpowaniu karnym.</li>
            <li><b>Kiedy w skr√≥cie:</b> gdy istniejƒÖ przes≈Çanki do zatrzymania (np. podejrzenie pope≈Çnienia przestƒôpstwa + potrzeba zabezpieczenia toku czynno≈õci / ryzyko ucieczki / ukrywania siƒô / niemo≈ºno≈õƒá ustalenia to≈ºsamo≈õci ‚Äî w praktyce zale≈ºnie od stanu faktycznego).</li>
            <li><b>Co trzeba zapewniƒá:</b> pouczenia o prawach, mo≈ºliwo≈õƒá kontaktu (np. obro≈Ñca / osoba najbli≈ºsza), prawid≈Çowe udokumentowanie przyczyn i czasu zatrzymania.</li>
            <li><b>Dokumenty:</b> protok√≥≈Ç zatrzymania, wzmianki/notatki o podstawie faktycznej, pouczenia, ewentualne badania (je≈õli zasadne), czynno≈õci z rzeczami.</li>
            <li><b>Kontrola:</b> zatrzymanie podlega kontroli (mo≈ºliwo≈õƒá z≈Ço≈ºenia za≈ºalenia), wiƒôc kluczowe sƒÖ <b>konkretne przes≈Çanki</b> i opis stanu faktycznego.</li>
          </ul>
        </div>

        <div class="lawCard">
          <div class="top">
            <div>
              <h3>art. 15 ustawy o Policji ‚Äî uprawnienia Policji</h3>
              <div class="meta"><code class="lawTag">art. 15 ust. o Policji</code></div>
            </div>
            <div class="actions">
              <button class="miniBtn" data-copy="full" data-text="art. 15 ustawy o Policji ‚Äî uprawnienia Policji">Kopiuj</button>
            </div>
          </div>
          <ul>
            <li><b>O co chodzi:</b> katalog podstawowych <b>uprawnie≈Ñ Policji</b> w zwiƒÖzku z wykonywaniem zada≈Ñ.</li>
            <li><b>Typowe przyk≈Çady:</b> legitymowanie os√≥b; zatrzymywanie os√≥b w przypadkach przewidzianych prawem; przeszukanie os√≥b/rzeczy/pomieszcze≈Ñ w granicach prawa; kontrola osobista (gdy sƒÖ przes≈Çanki); doprowadzenie; obserwacja i inne czynno≈õci operacyjne ‚Äî zale≈ºnie od podstawy.</li>
            <li><b>W praktyce:</b> zawsze wiƒÖ≈º to z <b>konkretnƒÖ podstawƒÖ faktycznƒÖ</b> (co policjant ustali≈Ç/zaobserwowa≈Ç) i w≈Ça≈õciwƒÖ podstawƒÖ prawnƒÖ dla danej czynno≈õci.</li>
            <li><b>Dokumentuj:</b> cel czynno≈õci, przebieg, wynik, pouczenia, dane os√≥b, uzasadnienie proporcjonalno≈õci.</li>
          </ul>
        </div>

        <div class="lawCard">
          <div class="top">
            <div>
              <h3>art. 16 ustawy o Policji ‚Äî zasady u≈ºycia ≈õrodk√≥w przymusu</h3>
              <div class="meta"><code class="lawTag">art. 16 ust. o Policji</code></div>
            </div>
            <div class="actions">
              <button class="miniBtn" data-copy="full" data-text="art. 16 ustawy o Policji ‚Äî zasady u≈ºycia ≈õrodk√≥w przymusu">Kopiuj</button>
            </div>
          </div>
          <ul>
            <li><b>O co chodzi:</b> og√≥lna zasada, ≈ºe Policja wykonuje czynno≈õci w spos√≥b <b>mo≈ºliwie najmniej naruszajƒÖcy dobra</b> i stosuje ≈õrodki adekwatne do sytuacji.</li>
            <li><b>Klucz:</b> <b>proporcjonalno≈õƒá, konieczno≈õƒá i celowo≈õƒá</b> ‚Äî wybierasz ≈õrodek najmniej dolegliwy, kt√≥ry pozwoli osiƒÖgnƒÖƒá legalny cel czynno≈õci.</li>
            <li><b>Praktycznie:</b> najpierw wezwanie/polecenie, dopiero gdy nieskuteczne lub niemo≈ºliwe ‚Äî eskalacja (zale≈ºnie od zagro≈ºenia).</li>
            <li><b>Dokumentuj:</b> dlaczego ≈õrodek by≈Ç konieczny, czemu nie wystarczy≈Çy ≈Çagodniejsze metody, jakie by≈Ço zagro≈ºenie i efekt.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Sekcja ≈öPB -->
    <section class="lawSection" id="spbSection">
      <div class="lawHeader">
        <div>
          <h2>üõ°Ô∏è ≈öPB ‚Äî ≈örodki Przymusu Bezpo≈õredniego (≈õciƒÖga)</h2>
          <div class="small">
            Skr√≥t operacyjny: kiedy rozwa≈ºyƒá u≈ºycie, o czym pamiƒôtaƒá i co dokumentowaƒá. (Zawsze stosuj aktualne procedury i przepisy).
          </div>
        </div>
        <span class="count" id="spbCount">0 ≈õrodk√≥w</span>
      </div>
      <div class="lawGrid" id="spbGrid"></div>
    </section>

    <!-- Sekcja: ≈õrodki letalne / nieletalne -->
    <section class="lawSection" id="lnSection">
      <div class="lawHeader">
        <div>
          <h2>‚öñÔ∏è ≈örodki letalne i nieletalne ‚Äî co to jest?</h2>
          <div class="small">
            Pojƒôcia opisowe (nie ‚Äúlista wyposa≈ºenia‚Äù): pomagajƒÖ rozr√≥≈ºniƒá ≈õrodki, kt√≥rych skutkiem mo≈ºe byƒá ≈õmierƒá, od tych projektowanych g≈Ç√≥wnie do obezw≈Çadnienia. Zawsze obowiƒÖzuje zasada legalno≈õci, konieczno≈õci i proporcjonalno≈õci.
          </div>
        </div>
        <span class="count">2 pojƒôcia</span>
      </div>

      <div class="lawGrid">
        <div class="lawCard">
          <div class="top">
            <div>
              <h3>≈örodki <b>letalne</b></h3>
              <div class="meta"><code class="lawTag">wysokie ryzyko ≈õmierci</code></div>
            </div>
            <div class="actions">
              <button class="miniBtn" data-copy="full" data-text="≈örodki letalne ‚Äî ≈õrodki, kt√≥rych u≈ºycie mo≈ºe z du≈ºym prawdopodobie≈Ñstwem spowodowaƒá ≈õmierƒá (np. bro≈Ñ palna). Stosowanie tylko w ≈õci≈õle okre≈õlonych prawem sytuacjach, przy spe≈Çnieniu przes≈Çanek i zasad (konieczno≈õƒá, proporcjonalno≈õƒá).">Kopiuj</button>
            </div>
          </div>
          <ul>
            <li><b>Znaczenie:</b> ≈õrodki, kt√≥rych u≈ºycie mo≈ºe z du≈ºym prawdopodobie≈Ñstwem prowadziƒá do <b>≈õmierci</b> osoby.</li>
            <li><b>Przyk≈Çad og√≥lny:</b> bro≈Ñ palna (w praktyce ‚Äî kategoria ‚Äúnajwy≈ºszego ryzyka‚Äù).</li>
            <li><b>Wa≈ºne:</b> ‚Äúletalny‚Äù nie znaczy ‚Äúna pewno zabija‚Äù, tylko ≈ºe <b>ryzyko ≈õmierci</b> jest istotne.</li>
            <li><b>Dokumentuj:</b> przes≈Çanki, dlaczego inne ≈õrodki by≈Çy niewystarczajƒÖce/niemo≈ºliwe, i jakie by≈Ço bezpo≈õrednie zagro≈ºenie.</li>
          </ul>
        </div>

        <div class="lawCard">
          <div class="top">
            <div>
              <h3>≈örodki <b>nieletalne</b> (mniej-letalne)</h3>
              <div class="meta"><code class="lawTag">obezw≈Çadnienie</code></div>
            </div>
            <div class="actions">
              <button class="miniBtn" data-copy="full" data-text="≈örodki nieletalne (mniej-letalne) ‚Äî projektowane g≈Ç√≥wnie do obezw≈Çadnienia/ograniczenia osoby bez powodowania ≈õmierci (np. kajdanki, si≈Ça fizyczna, ≈õrodki chemiczne, urzƒÖdzenia obezw≈ÇadniajƒÖce). Nadal mogƒÖ spowodowaƒá ciƒô≈ºkie obra≈ºenia, wiƒôc obowiƒÖzuje proporcjonalno≈õƒá i dokumentowanie.">Kopiuj</button>
            </div>
          </div>
          <ul>
            <li><b>Znaczenie:</b> ≈õrodki projektowane g≈Ç√≥wnie do <b>obezw≈Çadnienia</b> lub ograniczenia dzia≈Ça≈Ñ osoby, bez intencji powodowania ≈õmierci.</li>
            <li><b>Przyk≈Çady og√≥lne:</b> kajdanki, si≈Ça fizyczna, ≈õrodki chemiczne (gaz), urzƒÖdzenia obezw≈ÇadniajƒÖce ‚Äî zale≈ºnie od wyposa≈ºenia i procedur.</li>
            <li><b>Uwaga:</b> ‚Äúnieletalne‚Äù ‚â† ‚Äúbezpieczne‚Äù ‚Äî w z≈Çych warunkach/sposobie u≈ºycia mogƒÖ spowodowaƒá <b>powa≈ºne skutki</b>.</li>
            <li><b>Dokumentuj:</b> eskalacjƒô, warunki (t≈Çum, przestrze≈Ñ), czas u≈ºycia, skutki i czynno≈õci po u≈ºyciu (np. pomoc/ocena stanu).</li>
          </ul>
        </div>
      </div>
    </section>

    <footer>
      <div class="note">
        <b>Komenda Wojew√≥dzka Policji w Gda≈Ñsku | Summer RP</b>
      </div>
    </footer>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    const DATA = [
      // WYKROCZENIA
      {
        id: "drogowe",
        icon: "üöó",
        name: "Wykroczenia drogowe",
        desc: "Najczƒôstsze naruszenia w ruchu drogowym: prƒôdko≈õƒá, pierwsze≈Ñstwo, ≈õwiat≈Ça, dokumenty, stan techniczny itd.",
        items: [
          { t:"Przekroczenie dozwolonej prƒôdko≈õci", a:"art. 92a KW", p:"mandat od 50 do 2500 z≈Ç, 1‚Äì15 pkt" },
          { t:"Jazda bez prawa jazdy", a:"Art. 94 ¬ß1 k.w.", p:"Grzywna do 5 000 z≈Ç + zakaz prowadzenia do 3 lat" },
          { t:"Brak obowiƒÖzkowego ubezpieczenia OC pojazdu", a:"art. 95 ustawy o ubezpieczeniach obowiƒÖzkowych / UFG", p:"kara pieniƒô≈ºna od 1200 do 6000 z≈Ç (w zale≈ºno≈õci od d≈Çugo≈õci okresu braku OC), odpowiedzialno≈õƒá za szkody wyrzƒÖdzone osobom trzecim, mo≈ºliwe zatrzymanie dowodu rejestracyjnego" },
          { t:"NieustƒÖpienie pierwsze≈Ñstwa przejazdu", a:"art. 86 ¬ß1 KW", p:"mandat 300‚Äì1500 z≈Ç, 6 pkt" },
          { t:"Przejazd na czerwonym ≈õwietle", a:"art. 92 ¬ß1 KW", p:"mandat 500 z≈Ç, 6 pkt" },
          { t:"Nieprawid≈Çowe wyprzedzanie", a:"art. 86 ¬ß1 KW", p:"mandat 200‚Äì1000 z≈Ç, 8 pkt" },
          { t:"NieustƒÖpienie pierwsze≈Ñstwa pieszemu na przej≈õciu", a:"art. 86 ¬ß1 KW", p:"mandat 1500 z≈Ç, 15 pkt" },
          { t:"Korzystanie z telefonu podczas jazdy", a:"art. 97 KW", p:"mandat 500 z≈Ç, 12 pkt" },
          { t:"Jazda bez zapiƒôtych pas√≥w bezpiecze≈Ñstwa", a:"art. 97 KW", p:"mandat 100 z≈Ç, 5 pkt" },
          { t:"Nieprawid≈Çowe cofanie lub zawracanie", a:"art. 86 ¬ß1 KW", p:"mandat 200‚Äì300 z≈Ç, 6 pkt" },
          { t:"Nieposiadanie przy sobie dokument√≥w (prawo jazdy, dow√≥d rejestracyjny)", a:"art. 95 KW", p:"mandat 50 z≈Ç" },
          { t:"NieustƒÖpienie pierwsze≈Ñstwa pojazdowi uprzywilejowanemu", a:"art. 90 KW", p:"mandat 500 z≈Ç, 8 pkt" },
          { t:"Spowodowanie kolizji drogowej", a:"art. 86 ¬ß1 KW", p:"mandat 1000 z≈Ç, 10 pkt" },
          { t:"Nieprawid≈Çowe parkowanie", a:"art. 97 KW", p:"mandat 100‚Äì300 z≈Ç" },
          { t:"Zatrzymanie lub post√≥j w miejscu niedozwolonym", a:"art. 97 KW", p:"mandat 100‚Äì300 z≈Ç" },
          { t:"NiepodporzƒÖdkowanie siƒô poleceniom policjanta", a:"art. 92 ¬ß1 KW", p:"mandat 500 z≈Ç" },
          { t:"Ucieczka z miejsca kolizji", a:"art. 92 ¬ß1 KW", p:"mandat 2000 z≈Ç lub zatrzymanie prawa jazdy" },
          { t:"Jazda pojazdem niesprawnym technicznie", a:"art. 97 KW", p:"mandat 500 z≈Ç, mo≈ºliwe zatrzymanie dowodu rejestracyjnego" },
          { t:"Przew√≥z zbyt wielu pasa≈ºer√≥w", a:"art. 97 KW", p:"mandat 300 z≈Ç, 5 pkt" },
          { t:"Prowadzenie pojazdu z cofniƒôtymi uprawnieniami", a:"art. 180a KK", p:"Kara ograniczenia wolno≈õci do lat 2." },
          { t:"Ucieczka od kontroli przez osobƒô uprawnianƒÖ w ruchu drogowym", a:"art. 178b. KK", p:"Kara pozbawienia wolno≈õci od 3 miesiƒôcy do lat 5" },
          { t:"Prowadzenie pojazdu niedopuszczonego do ruchu (M.in. brak rejestracji)", a:"art. 94 ¬ß 2 KW", p:"Kara grzywny 1 500 z≈Ç lub skierowanie sprawy do sƒÖdu" },
        ]
      },
      {
        id: "porzadkowe",
        icon: "üè†",
        name: "Wykroczenia porzƒÖdkowe i administracyjne",
        desc: "PorzƒÖdek, czysto≈õƒá, cisza nocna, sanitariat, zwierzƒôta, utrzymanie posesji.",
        items: [
          { t:"Za≈õmiecanie miejsca publicznego", a:"art. 145 KW", p:"mandat 500 z≈Ç" },
          { t:"Zak≈Ç√≥canie ciszy nocnej", a:"art. 51 ¬ß1 KW", p:"mandat 500 z≈Ç" },
          { t:"Spo≈ºywanie alkoholu w miejscu publicznym", a:"art. 43¬π ustawy o wychowaniu w trze≈∫wo≈õci", p:"mandat 100 z≈Ç" },
          { t:"Wyrzucanie ≈õmieci poza wyznaczone miejsce", a:"art. 145 KW", p:"mandat 500 z≈Ç" },
          { t:"Niszczenie zieleni miejskiej", a:"art. 144 KW", p:"mandat 500 z≈Ç" },
          { t:"Wyprowadzanie psa bez smyczy lub kaga≈Ñca", a:"art. 77 KW", p:"mandat 250 z≈Ç" },
          { t:"Niew≈Ça≈õciwe utrzymanie posesji", a:"art. 117 ¬ß1 KW", p:"mandat 100‚Äì500 z≈Ç" },
          { t:"Nieprzestrzeganie przepis√≥w sanitarnych", a:"art. 116 ¬ß1 KW", p:"mandat 100‚Äì500 z≈Ç" },
          { t:"Za≈Çatwianie potrzeb fizjologicznych w miejscu publicznym", a:"art. 145 KW", p:"mandat 500 z≈Ç" },
        ]
      },
      {
        id: "publiczne",
        icon: "üßç‚Äç‚ôÇÔ∏è",
        name: "Wykroczenia przeciwko bezpiecze≈Ñstwu i porzƒÖdkowi publicznemu",
        desc: "Interwencje, to≈ºsamo≈õƒá, porzƒÖdek publiczny, fa≈Çszywe alarmy, wulgarno≈õƒá, b√≥jki, wandalizm.",
        items: [
          { t:"Utrudnianie interwencji policji lub stra≈ºy", a:"art. 65 KW", p:"mandat 500 z≈Ç" },
          { t:"Odmowa okazania dokumentu to≈ºsamo≈õci", a:"art. 65 ¬ß2 KW", p:"mandat 500 z≈Ç" },
          { t:"Podszywanie siƒô pod funkcjonariusza", a:"art. 61 ¬ß1 KW", p:"mandat 1000 z≈Ç lub areszt" },
          { t:"NiepodporzƒÖdkowanie siƒô poleceniom s≈Çu≈ºb", a:"art. 65 KW", p:"mandat 500 z≈Ç" },
          { t:"Zak≈Ç√≥canie porzƒÖdku publicznego", a:"art. 51 ¬ß1 KW", p:"mandat 500 z≈Ç" },
          { t:"Udzia≈Ç w b√≥jce lub pobiciu", a:"art. 158 KK", p:"kara aresztu lub wiƒôzienia" },
          { t:"Drobne akty wandalizmu", a:"art. 124 KW", p:"mandat 500‚Äì1000 z≈Ç" },
          { t:"Malowanie graffiti bez zgody w≈Ça≈õciciela", a:"art. 124 KW", p:"mandat 500 z≈Ç" },
          { t:"Nieudzielenie pomocy ofierze wypadku", a:"art. 93 KW", p:"mandat 500 z≈Ç lub kara aresztu" },
          { t:"U≈ºywanie nielegalnych sygna≈Ç√≥w ≈õwietlnych lub d≈∫wiƒôkowych", a:"art. 96 ¬ß1 KW", p:"mandat 500 z≈Ç" },
          { t:"Rozpowszechnianie fa≈Çszywych alarm√≥w", a:"art. 66 KW", p:"mandat 1500 z≈Ç lub areszt" },
          { t:"Publiczne u≈ºywanie s≈Ç√≥w nieprzyzwoitych", a:"art. 141 KW", p:"mandat 500 z≈Ç" },
          { t:"Zak≈Ç√≥canie zgromadzenia lub manifestacji", a:"art. 52 KW", p:"mandat 500 z≈Ç" },
        ]
      },

      // PRZESTƒòPSTWA
      {
        id: "prz_drogowe",
        icon: "üöì",
        name: "Przestƒôpstwa drogowe",
        desc: "Przestƒôpstwa w ruchu drogowym (nietrze≈∫wo≈õƒá, narkotyki, wypadki, ucieczki).",
        items: [
          { t:"Prowadzenie pojazdu w stanie nietrze≈∫wo≈õci", a:"art. 178a KK", p:"kara pozbawienia wolno≈õci do 2 lat, zakaz prowadzenia pojazd√≥w" },
          { t:"Spowodowanie wypadku ze skutkiem ≈õmiertelnym", a:"art. 177 ¬ß2 KK", p:"kara pozbawienia wolno≈õci 6 miesiƒôcy ‚Äì 8 lat" },
          { t:"Ucieczka z miejsca wypadku", a:"art. 178 ¬ß1 KK", p:"kara pozbawienia wolno≈õci do 3 lat" },
          { t:"Prowadzenie pojazdu pod wp≈Çywem narkotyk√≥w", a:"art. 178a ¬ß1 KK", p:"kara pozbawienia wolno≈õci do 2 lat, zakaz prowadzenia pojazd√≥w" },
        ]
      },
      {
        id: "prz_mienie",
        icon: "üè¶",
        name: "Przestƒôpstwa przeciwko mieniu",
        desc: "Kradzie≈ºe, w≈Çamania, rozboje, przyw≈Çaszczenia i oszustwa.",
        items: [
          { t:"Kradzie≈º", a:"art. 278 KK", p:"kara pozbawienia wolno≈õci do 5 lat" },
          { t:"Kradzie≈º z w≈Çamaniem", a:"art. 279 KK", p:"kara pozbawienia wolno≈õci od 3 miesiƒôcy do 5 lat" },
          { t:"Rozb√≥j", a:"art. 280 KK", p:"kara pozbawienia wolno≈õci od 2 do 12 lat" },
          { t:"Przyw≈Çaszczenie", a:"art. 284 KK", p:"kara pozbawienia wolno≈õci do 3 lat" },
          { t:"Oszustwo", a:"art. 286 KK", p:"kara pozbawienia wolno≈õci do 8 lat" },
        ]
      },
      {
        id: "prz_osoba",
        icon: "üßç‚Äç‚ôÇÔ∏è",
        name: "Przestƒôpstwa przeciwko osobie",
        desc: "Przemoc, gro≈∫by, nara≈ºenie ≈ºycia/zdrowia, ciƒô≈ºkie skutki.",
        items: [
          { t:"Pobicie", a:"art. 158 KK", p:"kara pozbawienia wolno≈õci do 3 lat" },
          { t:"Ciƒô≈ºkie uszkodzenie cia≈Ça", a:"art. 156 KK", p:"kara pozbawienia wolno≈õci od 6 miesiƒôcy do 8 lat" },
          { t:"Zab√≥jstwo", a:"art. 148 KK", p:"kara pozbawienia wolno≈õci od 8 lat do do≈ºywocia" },
          { t:"Gro≈∫by karalne", a:"art. 190 KK", p:"kara pozbawienia wolno≈õci do 2 lat" },
          { t:"Nara≈ºenie na bezpo≈õrednie niebezpiecze≈Ñstwo utraty ≈ºycia lub zdrowia", a:"art. 160 KK", p:"kara pozbawienia wolno≈õci do 3 lat" },
        ]
      },
      {
        id: "prz_bezp",
        icon: "üî´",
        name: "Przestƒôpstwa przeciwko bezpiecze≈Ñstwu publicznemu",
        desc: "Bro≈Ñ bez zezwolenia, utrudnianie czynno≈õci, porwania, czyny terrorystyczne.",
        items: [
          { t:"Posiadanie i u≈ºywanie broni bez zezwolenia", a:"art. 263 KK", p:"kara pozbawienia wolno≈õci do 8 lat" },
          { t:"Utrudnianie czynno≈õci s≈Çu≈ºb publicznych", a:"art. 224 KK", p:"kara pozbawienia wolno≈õci do 3 lat" },
          { t:"Porwanie", a:"art. 189 KK", p:"kara pozbawienia wolno≈õci od 3 do 15 lat" },
          { t:"Terroryzm i gro≈∫ba u≈ºycia przemocy", a:"art. 118 KK", p:"kara pozbawienia wolno≈õci od 5 do 15 lat" },
        ]
      },
      {
        id: "prz_gosp",
        icon: "üí∞",
        name: "Przestƒôpstwa gospodarcze",
        desc: "Dokumenty, pieniƒÖdze, korupcja, nadu≈ºycia i oszustwa podatkowe.",
        items: [
          { t:"Fa≈Çszowanie pieniƒôdzy lub dokument√≥w", a:"art. 270 KK", p:"kara pozbawienia wolno≈õci do 5 lat" },
          { t:"Korupcja i ≈Çapownictwo", a:"art. 228 KK", p:"kara pozbawienia wolno≈õci od 6 miesiƒôcy do 8 lat" },
          { t:"Podrabianie faktur i oszustwa podatkowe", a:"art. 271 KK", p:"kara pozbawienia wolno≈õci do 5 lat" },
        ]
      },
    ];

    // ≈öPB ‚Äî ≈örodki Przymusu Bezpo≈õredniego (≈õciƒÖga)
    const SPB = [
      {
        title: "Wezwanie/polecenie + ostrze≈ºenie",
        tag: "deeskalacja",
        copy: "≈öPB ‚Äî wezwanie/polecenie + ostrze≈ºenie: tre≈õƒá polecenia, reakcja osoby, dlaczego nieskuteczne/niemo≈ºliwe, podstawa eskalacji.",
        bullets: [
          "Je≈õli mo≈ºliwe: najpierw wyra≈∫ne polecenie i ostrze≈ºenie o u≈ºyciu ≈öPB.",
          "Komunikat kr√≥tki: co ma zrobiƒá + konsekwencje + czas na reakcjƒô (je≈õli sytuacja pozwala).",
          "Dokumentuj: tre≈õƒá polecenia, reakcjƒô, pow√≥d eskalacji."
        ]
      },
      {
        title: "Chwyty obezw≈ÇadniajƒÖce / techniki transportowe",
        tag: "fizyczne",
        copy: "≈öPB ‚Äî chwyty/transport: pow√≥d zastosowania, op√≥r/zagro≈ºenie, przebieg, czas, ewentualne obra≈ºenia, kontrola stanu osoby.",
        bullets: [
          "Stosuj adekwatnie do oporu i zagro≈ºenia (minimum konieczne).",
          "Unikaj dzia≈Ça≈Ñ zwiƒôkszajƒÖcych ryzyko uraz√≥w; kontroluj oddech/stan osoby.",
          "Dokumentuj: rodzaj oporu, zastosowanƒÖ technikƒô, czas i efekt."
        ]
      },
      {
        title: "Si≈Ça fizyczna (odp√≥r, obalenie, przytrzymanie)",
        tag: "fizyczne",
        copy: "≈öPB ‚Äî si≈Ça fizyczna: przes≈Çanki, rodzaj oporu, dlaczego inne ≈õrodki nie wystarczy≈Çy, czas trwania, skutki, udzielenie pomocy (je≈õli potrzebne).",
        bullets: [
          "U≈ºywaj proporcjonalnie; przerywaj gdy cel osiƒÖgniƒôty.",
          "Zabezpiecz miejsce i osoby postronne.",
          "Dokumentuj: przes≈Çanki, stopie≈Ñ oporu, czas, skutki."
        ]
      },
      {
        title: "Kajdanki",
        tag: "ograniczenie",
        copy: "≈öPB ‚Äî kajdanki: przes≈Çanki (ryzyko ucieczki/agresji/autoagresji), spos√≥b za≈Ço≈ºenia, kontrola dopasowania, czas u≈ºycia, kontrola stanu osoby.",
        bullets: [
          "Stosuj gdy istniejƒÖ przes≈Çanki (bezpiecze≈Ñstwo, ucieczka, op√≥r).",
          "Po za≈Ço≈ºeniu: kontrola dopasowania i krƒÖ≈ºenia; nadz√≥r osoby.",
          "Dokumentuj: dlaczego, kiedy, na jak d≈Çugo, reakcja osoby."
        ]
      },
      {
        title: "Pa≈Çka s≈Çu≈ºbowa",
        tag: "uderzeniowe",
        copy: "≈öPB ‚Äî pa≈Çka: realne zagro≈ºenie, ostrze≈ºenie (je≈õli mo≈ºliwe), miejsca dopuszczalne, czas, efekt, udzielenie pomocy/wezwanie medyczne gdy potrzeba.",
        bullets: [
          "Rozwa≈º tylko przy realnym zagro≈ºeniu i braku skuteczno≈õci ≈Çagodniejszych ≈õrodk√≥w.",
          "Cel: przerwanie ataku/obezw≈Çadnienie; minimum konieczne.",
          "Dokumentuj: zagro≈ºenie, eskalacjƒô, spos√≥b u≈ºycia, skutki."
        ]
      },
      {
        title: "Gaz / ≈õrodki obezw≈ÇadniajƒÖce",
        tag: "chemiczne",
        copy: "≈öPB ‚Äî gaz: warunki (wiatr, t≈Çum), ostrze≈ºenie (je≈õli mo≈ºliwe), odleg≈Ço≈õƒá, czas ekspozycji, dekontaminacja/pomoc.",
        bullets: [
          "Uwa≈ºaj na osoby postronne i przestrzenie zamkniƒôte.",
          "Po u≈ºyciu: zapewnij przewietrzenie, p≈Çukanie, pomoc medycznƒÖ gdy trzeba.",
          "Dokumentuj: pow√≥d, warunki, efekt, czynno≈õci po u≈ºyciu."
        ]
      },
      {
        title: "Taser / urzƒÖdzenie obezw≈ÇadniajƒÖce (je≈õli u≈ºywane w jednostce)",
        tag: "elektro",
        copy: "≈öPB ‚Äî taser: przes≈Çanki, ostrze≈ºenie, dystans, liczba cykli, efekt, zabezpieczenie osoby, kontrola medyczna gdy wskazana.",
        bullets: [
          "Stosuj zgodnie z procedurƒÖ i tylko przy przes≈Çankach.",
          "Po u≈ºyciu: kontrola stanu osoby, zabezpieczenie, ewentualna pomoc.",
          "Dokumentuj: liczba u≈ºyƒá, czas, efekt, dalsze czynno≈õci."
        ]
      },
      {
        title: "Kask ochronny / tarcza / sprzƒôt ochronny",
        tag: "ochrona",
        copy: "≈öPB ‚Äî sprzƒôt ochronny: pow√≥d, rodzaj zagro≈ºenia, zastosowanie w dzia≈Çaniach, wp≈Çyw na bezpiecze≈Ñstwo i przebieg.",
        bullets: [
          "W dzia≈Çaniach zbiorowych ‚Äî priorytetem jest ochrona i minimalizacja eskalacji.",
          "Ustal role i komunikacjƒô w zespole.",
          "Dokumentuj: pow√≥d u≈ºycia i przebieg dzia≈Ça≈Ñ."
        ]
      },
      {
        title: "Wod√≥rka / inne ≈õrodki specjalne (je≈õli dotyczy RP/Twoich zasad)",
        tag: "specjalne",
        copy: "≈öPB ‚Äî ≈õrodki specjalne: podstawa i rozkaz/zgoda (je≈õli wymagana), ostrze≈ºenia, przebieg, efekty, zabezpieczenie os√≥b postronnych.",
        bullets: [
          "Stosuj wy≈ÇƒÖcznie zgodnie z zasadami serwera/procedurami.",
          "Priorytet: bezpiecze≈Ñstwo os√≥b postronnych.",
          "Dokumentuj: kto podjƒÖ≈Ç decyzjƒô, kiedy, dlaczego, efekt."
        ]
      }
    ];

    const $ = (sel) => document.querySelector(sel);
    const out = $("#out");
    const q = $("#q");
    const category = $("#category");
    const sortSel = $("#sort");
    const countEl = $("#count");
    const catCountEl = $("#catCount");
    const chipsEl = $("#chips");
    const toast = $("#toast");
    const favCountEl = $("#favCount");

    // ≈öPB elements
    const spbGrid = $("#spbGrid");
    const spbCount = $("#spbCount");

    // ‚≠ê Ulubione
    const FAV_KEY = "policja_favs_v1";
    let favOnly = false;

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1700);
    }

    function norm(s){ return (s||"").toString().toLowerCase().replace(/\s+/g," ").trim(); }

    // (5) Normalizacja wyszukiwania: odporna na kropki/spacje/odmiany typu "Art. 178b. KK"
    function normSearch(s){
      const raw = (s || "").toString().toLowerCase();
      // usu≈Ñ znaki diakrytyczne (opcjonalnie, pomaga np. "kradziez" vs "kradzie≈º")
      const noDia = raw.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
      // ujednoliƒá separatory, kropki itp.
      return noDia
        .replace(/[\.,;:(){}\[\]"]/g, " ")
        .replace(/[‚Äì‚Äî-]/g, " ")
        .replace(/\s+/g, " ")
        .trim();
    }

    function isKKorUstawaOrKPK(article){
      const a = normSearch(article);
      return a.includes("kk") || a.includes("ustaw") || a.includes("kpk");
    }

    function itemKey(it){
      return `${normSearch(it.title)}|${normSearch(it.article)}`;
    }
    function loadFavs(){
      try { return new Set(JSON.parse(localStorage.getItem(FAV_KEY) || "[]")); }
      catch { return new Set(); }
    }
    function saveFavs(set){
      localStorage.setItem(FAV_KEY, JSON.stringify([...set]));
    }
    let favs = loadFavs();
    function isFav(it){ return favs.has(itemKey(it)); }
    function toggleFav(it){
      const k = itemKey(it);
      if(favs.has(k)) favs.delete(k);
      else favs.add(k);
      saveFavs(favs);
    }

    function init(){
      for(const c of DATA){
        const opt = document.createElement("option");
        opt.value = c.id;
        opt.textContent = `${c.icon} ${c.name}`;
        category.appendChild(opt);
      }

      const quick = [
        { label:"Prƒôdko≈õƒá", q:"92a" },
        { label:"Nietrze≈∫wo≈õƒá", q:"178a" },
        { label:"Kradzie≈º", q:"278" },
        { label:"Rozb√≥j", q:"280" },
        { label:"Gro≈∫by", q:"190" },
        { label:"Bro≈Ñ", q:"263" },
        { label:"To≈ºsamo≈õƒá", q:"65 ¬ß2" },
        { label:"244 KPK", q:"244 kpk" },
        { label:"Art. 15", q:"art. 15" },
      ];

      quick.forEach(ch => {
        const el = document.createElement("div");
        el.className = "chip";
        el.innerHTML = `<strong>${ch.label}</strong> <span class="mini">(${ch.q})</span>`;
        el.addEventListener("click", ()=>{
          q.value = ch.q;
          render();
          [...chipsEl.querySelectorAll(".chip")].forEach(x=>x.classList.remove("active"));
          el.classList.add("active");
          q.focus();
        });
        chipsEl.appendChild(el);
      });

      const saved = localStorage.getItem("policja_theme");
      if(saved === "light") document.documentElement.setAttribute("data-theme","light");

      $("#btnTheme").addEventListener("click", toggleTheme);
      $("#btnPrint").addEventListener("click", ()=>window.print());

      $("#btnFavs").addEventListener("click", ()=>{
        favOnly = !favOnly;
        showToast(favOnly ? "Tylko ulubione ‚≠ê" : "Wszystkie wpisy");
        render();
      });

      q.addEventListener("input", render);
      category.addEventListener("change", render);
      sortSel.addEventListener("change", render);

      // kopiowanie w sekcji przepis√≥w + definicje letalne/nieletalne
      document.querySelectorAll("[data-copy]").forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const text = e.currentTarget.getAttribute("data-text") || "";
          copyText(text);
        });
      });

      renderSPB();
      render();
    }

    function toggleTheme(){
      const cur = document.documentElement.getAttribute("data-theme");
      const next = cur === "light" ? "" : "light";
      if(next) document.documentElement.setAttribute("data-theme", next);
      else document.documentElement.removeAttribute("data-theme");
      localStorage.setItem("policja_theme", next || "dark");
    }

    function flatten(){
      const list = [];
      for(const c of DATA){
        for(const it of c.items){
          const title = it.t;
          const article = it.a;
          const penalty = it.p;

          // (5) precomputed search index
          const hay = normSearch(`${title} ${article} ${penalty} ${c.name} ${c.id} ${c.icon}`);
          const hayCompact = hay.replace(/\s+/g, "");

          list.push({
            catId: c.id,
            catName: c.name,
            catIcon: c.icon,
            title,
            article,
            penalty,
            _hay: hay,
            _hay2: hayCompact
          });
        }
      }
      return list;
    }

    function applyFilters(items){
      const qv = normSearch(q.value);
      const qv2 = qv.replace(/\s+/g, "");
      const cat = category.value;

      let res = items.filter(x => (cat === "all" ? true : x.catId === cat));

      if(favOnly){
        res = res.filter(x => isFav(x));
      }

      if(qv){
        res = res.filter(x => x._hay.includes(qv) || x._hay2.includes(qv2));
      }

      const s = sortSel.value;
      if(s !== "default"){
        const by = (k) => (a,b) => normSearch(a[k]).localeCompare(normSearch(b[k]), "pl");
        if(s === "name_asc") res.sort(by("title"));
        if(s === "name_desc") res.sort((a,b)=>by("title")(b,a));
        if(s === "article_asc") res.sort(by("article"));
        if(s === "article_desc") res.sort((a,b)=>by("article")(b,a));
      }
      return res;
    }

    function groupByCategory(items){
      const map = new Map();
      for(const c of DATA){ map.set(c.id, { ...c, items: [] }); }
      for(const it of items){ map.get(it.catId).items.push(it); }
      return [...map.values()].filter(c => c.items.length > 0);
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        showToast("Skopiowano ‚úÖ");
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        showToast("Skopiowano ‚úÖ");
      }
    }

    function cardHTML(it){
      const lawClass = isKKorUstawaOrKPK(it.article) ? "lawTag" : "";
      const full = `${it.title} ‚Äî ${it.article} ‚Äî ${it.penalty}`;
      const favClass = isFav(it) ? "active" : "";
      const favLabel = isFav(it) ? "‚òÖ" : "‚òÜ";
      const favTitle = isFav(it) ? "Usu≈Ñ z ulubionych" : "Dodaj do ulubionych";

      return `
        <div class="card">
          <div class="row1">
            <div>
              <p class="offense">${escapeHtml(it.title)}</p>
              <div class="meta">
                <code class="${lawClass}">${escapeHtml(it.article)}</code>
              </div>
            </div>
            <div class="actions">
              <button class="starBtn ${favClass}" data-fav="toggle" data-key="${escapeAttr(itemKey(it))}" title="${escapeAttr(favTitle)}">${favLabel}</button>
              <button class="miniBtn" data-copy="article" data-text="${escapeAttr(it.article)}" title="Kopiuj artyku≈Ç">Kopiuj art.</button>
              <button class="miniBtn" data-copy="full" data-text="${escapeAttr(full)}" title="Kopiuj ca≈Çy wpis">Kopiuj wpis</button>
            </div>
          </div>
          <p class="penalty">${escapeHtml(it.penalty)}</p>
        </div>
      `;
    }

    function render(){
      // od≈õwie≈º ulubione z localStorage na wszelki wypadek
      favs = loadFavs();
      favCountEl.textContent = favs.size.toString();

      const all = flatten();
      const filtered = applyFilters(all);
      const grouped = groupByCategory(filtered);

      countEl.textContent = filtered.length.toString();
      catCountEl.textContent = grouped.length.toString();
      out.innerHTML = "";

      for(const cat of grouped){
        const det = document.createElement("details");
        det.open = true;
        det.innerHTML = `
          <summary>
            <div class="catTitle">
              <div class="name">${cat.icon} ${escapeHtml(cat.name)}</div>
              <div class="desc">${escapeHtml(cat.desc)}</div>
            </div>
            <div class="count">${cat.items.length} pozycji</div>
          </summary>
          <div class="items">
            ${cat.items.map(cardHTML).join("")}
          </div>
        `;
        out.appendChild(det);
      }

      if(grouped.length === 0){
        out.innerHTML = `
          <div class="panel" style="margin-top:8px">
            <b>Brak wynik√≥w.</b>
            <div class="sub" style="margin-top:6px">Spr√≥buj innej frazy (np. <code>178a</code>, <code>278</code>, <code>244 kpk</code>). Albo wy≈ÇƒÖcz filtr ulubionych ‚≠ê.</div>
          </div>
        `;
      }

      // kopiowanie
      out.querySelectorAll("[data-copy]").forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const text = e.currentTarget.getAttribute("data-text") || "";
          copyText(text);
        });
      });

      // ‚≠ê obs≈Çuga ulubionych
      out.querySelectorAll("[data-fav='toggle']").forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const key = e.currentTarget.getAttribute("data-key") || "";
          if(!key) return;

          // znajd≈∫ item po kluczu (w przefiltrowanej li≈õcie / all)
          const allNow = flatten();
          const target = allNow.find(x => itemKey(x) === key);
          if(!target) return;

          toggleFav(target);
          showToast(isFav(target) ? "Dodano do ulubionych ‚≠ê" : "Usuniƒôto z ulubionych");
          render();
        });
      });
    }

    function renderSPB(){
      if(!spbGrid || !spbCount) return;

      spbCount.textContent = `${SPB.length} ≈õrodk√≥w`;
      spbGrid.innerHTML = SPB.map((s) => {
        const tag = s.tag ? `<code class="lawTag">${escapeHtml(s.tag)}</code>` : "";
        const bullets = (s.bullets || []).map(b => `<li>${escapeHtml(b)}</li>`).join("");
        const copyTextVal = s.copy || `≈öPB ‚Äî ${s.title}`;
        return `
          <div class="lawCard">
            <div class="top">
              <div>
                <h3>${escapeHtml(s.title)}</h3>
                <div class="meta">${tag}</div>
              </div>
              <div class="actions">
                <button class="miniBtn" data-copy="spb" data-text="${escapeAttr(copyTextVal)}">Kopiuj</button>
              </div>
            </div>
            <ul>${bullets}</ul>
          </div>
        `;
      }).join("");

      spbGrid.querySelectorAll("[data-copy='spb']").forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const text = e.currentTarget.getAttribute("data-text") || "";
          copyText(text);
        });
      });
    }

    function escapeHtml(str){
      return (str||"").replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
    }
    function escapeAttr(str){
      return escapeHtml(str).replace(/`/g, "&#96;");
    }

    init();
  </script>
</body>
</html>
